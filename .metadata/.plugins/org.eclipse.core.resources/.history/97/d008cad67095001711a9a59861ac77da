package com.sredmond.server;

import java.io.ByteArrayOutputStream;
import java.io.File;
import java.io.InputStream;

import javax.servlet.http.HttpServlet; 
import javax.servlet.http.HttpServletRequest; 
import javax.servlet.http.HttpServletResponse; 

import org.apache.commons.fileupload.FileItemIterator; 
import org.apache.commons.fileupload.FileItemStream; 
import org.apache.commons.fileupload.servlet.ServletFileUpload; 


@SuppressWarnings("serial")
public class FileUploadServlet extends HttpServlet{
	public void doPost(HttpServletRequest req, HttpServletResponse res) {
		ServletFileUpload fu = new ServletFileUpload();
		
		try
		{
			FileItemIterator itr = fu.getItemIterator(req);
			
			while(itr.hasNext()) {
				FileItemStream item = itr.next();
				String name = item.getFieldName();
				InputStream stream = item.openStream();
				
				
				File file = new File("C:\\Users\\Sam\\Documents\\");
				
				ByteArrayOutputStream out = new ByteArrayOutputStream();
				int length;
				byte[] buffer = new byte[8192];
				while((length = stream.read(buffer, 0, buffer.length)) != -1) {
					out.write(buffer, 0, length);
				}
				
				int maxFileSize = 10*(1024*1024);
				if(out.size() > maxFileSize) {
					throw new RuntimeException("File is too large");
				}
			}
		}
		catch(Exception e) {
			throw new RuntimeException(e);
		}
	}
}
